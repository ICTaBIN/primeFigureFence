<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{% endblock %} Calculator</title>
    {% block styles %}{% endblock %}
</head>
<body>
<div class="container">
    <a href="#" onclick="window.history.back(); return false;" class="back-button">‚Üê Back to Drawing Tool</a>
    <h1>{% block heading %}{% endblock %} Calculator</h1>

    <div class="summary-grid">
        <div class="summary-item">
            <label for="totalLinearFeet">Total Linear Feet</label>
            <input type="number" id="totalLinearFeet" min="0" step="0.1" readonly>
        </div>
        <div class="summary-item">
            <label for="height">Fence Height (ft)</label>
            <input type="number" id="height" min="0" readonly>
        </div>
        <div class="summary-item">
            <label for="totalGates">Gates</label>
            <input type="number" id="totalGates" min="0" readonly>
        </div>
        <div class="summary-item">
            <label for="totalCornerPosts">Corner Posts</label>
            <input type="number" id="totalCornerPosts" min="0" readonly>
        </div>
        <div class="summary-item">
            <label for="totalEndPosts">End Posts</label>
            <input type="number" id="totalEndPosts" min="0" readonly>
        </div>
        <div class="summary-item">
            <label for="totalLinePosts">Line Posts</label>
            <input type="number" id="totalLinePosts" min="0" readonly>
        </div>
    </div>

    <div class="tax-controls">
        <div class="tax-options">
            <label class="tax-option">
                <input type="checkbox" id="materialsTaxable" >
                Materials Taxable
            </label>
            <label class="tax-option">
                <input type="checkbox" id="laborTaxable" >
                Labor Taxable
            </label>
        </div>
    </div>

    <div class="materials-section">
        <table id="materialsTable">
            <thead>
                <tr>
                    <th>QTY</th>
                    <th>Item</th>
                    <th>Style/Type</th>
                    <th>Unit Price</th>
                    <th>Tax</th>
                    <th>Total Price</th>
                </tr>
            </thead>
            <tbody>
                <!-- Table content will be added dynamically -->
                {% for material, material_item in grouped_materials.items %}
                
                <tr>
                    <td>
                        <input type="number" id="{{material}}Qty" class="quantity-input" min="0" onchange="qtyChange(this)">
                    </td>

                    <td>
                        {{material}}
                   </td>   

                   <td>
                       <select id="{{material}}Select" onchange="updatePrice(this)">
                       {% for item in material_item %}
                         <option material-type="{{material}}" value="{{item.material_data.name}}" material-price="{{item.material_data.price}}">{{item.material_data.name}}</option>
                         {% endfor %}
                        </select>
                    </td> 

                    <td>
                        {% for item in material_item %}
                        {% if forloop.first %}
                        <span id="{{material}}Price">${{item.material_data.price}}</span>
                        {% endif %}
                        {% endfor %}
                    </td>

                    <td>
                        <input type="checkbox" id="concreteTax" class="tax-checkbox">
                    </td>

                    <td id="{{material}}Total">
                        {% for item in material_item %}
                        {% if forloop.first %}
                        $0
                        {% endif %}
                        {% endfor %}
                    </td>
                </tr>
            
                {% endfor %}

            </tbody>
        </table>

        <div class="button-group">
            <button id="addCustomRow" class="btn-primary">+ Add Custom Item</button>
            <button id="save-template" class="btn-primary">Save Template</button>
            <button id="load-template" class="btn-primary">Load Template</button>
        </div>
    </div>

    <div class="calculations-wrapper">
        <div class="rates-section">
            <div class="rate-item">
                <label for="laborRate">Labor Rate (per ft)</label>
                <div class="rate-input-group">
                    <input type="number" id="laborRate" value="{{labor_rate|default:7.5}}" min="0" step="0.1">
                </div>
            </div>
            <div class="rate-item">
                <label for="taxRate">Tax Rate (%)</label>
                <input type="number" id="taxRate" value="{{overhead_rates.tax_rate|default:8}}" min="0" max="100" step="0.1">
            </div>
            <div class="rate-item">
                <label for="marginPercent">Margin Percent</label>
                <input type="number" id="marginPercent" value="{{overhead_rates.margin_percent|default:23}}" min="0" max="100">
            </div>
        </div>

        <div class="totals-section">
            <div class="total-item">
                <strong>Material Cost</strong>
                <div>$<span id="materialCost">0.00</span></div>
            </div>
            <div class="total-item">
                <strong>Labor Cost</strong>
                <div>$<span id="laborCost">0.00</span></div>
            </div>
            <div class="total-item">
                <strong>Overhead</strong>
                <div>$<span id="profitAmount">0.00</span></div>
            </div>
            <div class="total-item">
                <strong>Tax</strong>
                <div>$<span id="taxCost">0.00</span></div>
            </div>
            <div class="final-total">
                Total Cost: $<span id="totalCost">0.00</span>
            </div>
        </div>
    </div>
    <button id="convertToProposal">Convert to Proposal</button>
    <input name="customer_id" type="hidden" id="customerId" value="{{customer_id}}">

    <canvas id="drawing-preview"></canvas>
</div>


{% block scripts %}{% endblock %}

</body>